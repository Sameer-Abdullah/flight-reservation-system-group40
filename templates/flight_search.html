{% extends "base.html" %}
{% set body_class = 'auth-bg' %}
{% block content %}
<style>
  :root{
    --ink:#0b2545;
    --brand:#0ea5e9;
    --brand-deep:#0369a1;
    --accent:#ffd60a;
    --ring:rgba(14,165,233,.25);
    --card:#ffffff;
    --muted:#64748b;
  }

  /* ===== Sky background ===== */
  body.auth-bg{
    min-height:100vh; overflow-x:hidden; color:var(--ink);
    background:
      radial-gradient(1200px 600px at 85% -10%, rgba(255,255,255,.45), transparent 60%),
      linear-gradient(180deg, #dff6ff 0%, #f8fdff 28%, #ffffff 100%);
    background-attachment: fixed;
  }
  .sky-anim{ position: fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden; }
  .sky-anim::before{
    content:""; position:absolute; inset:-20%;
    background:
      radial-gradient(40% 30% at 20% 15%, rgba(56,189,248,.35), transparent 55%),
      radial-gradient(50% 40% at 80% 0%, rgba(2,132,199,.25), transparent 60%),
      radial-gradient(60% 50% at 40% 100%, rgba(14,165,233,.25), transparent 60%);
    filter: blur(20px);
    animation: skyPulse 18s ease-in-out infinite alternate;
  }
  @keyframes skyPulse{ 0%{transform:translateY(0) scale(1)} 100%{transform:translateY(-3%) scale(1.06)} }
  .auth-cloud{ position: fixed; width:160px; opacity:.22; z-index:0; filter: drop-shadow(0 6px 14px rgba(0,0,0,.08)); animation: drift 60s linear infinite; }
  .auth-cloud.c1{ top:10%; left:-180px; }
  .auth-cloud.c2{ top:46%; left:-300px; animation-delay:10s; }
  @keyframes drift{0%{transform:translateX(0)}100%{transform:translateX(130vw)}}

  /* ===== Header ===== */
  .page-head .brand-badge{
    display:inline-flex; align-items:center; gap:.5rem;
    padding:.35rem .7rem; border-radius:999px; font-weight:700;
    background: rgba(255,255,255,.65); border:1px solid rgba(2,6,23,.08);
    backdrop-filter: blur(6px);
  }
  .page-head h2{ font-weight:800; }

  /* ===== Search Card ===== */
  .search-card{
    max-width: 1160px; margin-inline:auto;
    background: rgba(255,255,255,.78);
    border:1px solid rgba(2,6,23,.08);
    border-radius:22px; box-shadow:0 24px 60px rgba(2,6,23,.10);
    backdrop-filter: blur(12px); padding:18px;
  }
  .trip-toggle .btn{ border-radius:999px; font-weight:700; padding:.5rem .9rem; }
  .form-label{ font-weight:600; color:#1f2937; }
  .input-group-text{ background:#f8fafc; border-color:#e5e7eb; color:#6b7280; }
  .form-control, .form-select{ border-color:#e5e7eb; }
  .form-control:focus, .form-select:focus{ border-color: var(--brand); box-shadow: 0 0 0 .25rem var(--ring); }
  .swap-btn{ border-radius:12px; border:1px dashed #cbd5e1; background:#fff; }
  .swap-btn:hover{ border-color: var(--brand); color: var(--brand-deep); }
  .btn-search{
    padding:.9rem 1rem; border-radius:14px; font-weight:800;
    background: linear-gradient(135deg, var(--brand-deep), var(--brand)); border:none;
    box-shadow:0 10px 24px rgba(2,6,23,.08);
  }

  /* Quick route pills */
  .quick-chips .chip{
    display:inline-flex; align-items:center; gap:.4rem; margin:.25rem;
    padding:.4rem .7rem; border-radius:999px; font-weight:600; font-size:.9rem;
    background:#fff; border:1px solid #e5e7eb;
  }
  .quick-chips .chip i{ color:var(--brand-deep); }

  /* ===== Advanced filters ===== */
  .adv-toggle{ cursor:pointer; user-select:none; }
  .adv-panel{ display:none; }
  .range-wrap{ display:flex; align-items:center; gap:.5rem; }
  .range-wrap input[type="range"]{ width:100%; }

  /* ===== Sticky summary ===== */
  .summary-bar{
    position: sticky; top: 72px; z-index: 5;
    background: rgba(255,255,255,.85); backdrop-filter: blur(8px);
    border:1px solid rgba(2,6,23,.08); border-radius:12px; padding:8px 12px;
  }
  .tag{ display:inline-flex; align-items:center; gap:.4rem; padding:.25rem .6rem; border-radius:999px; font-weight:600; background:#f8fafc; border:1px solid #e5e7eb; color:#0f172a; }

  /* ===== Results ===== */
  .results-wrap{ max-width:1160px; margin-inline:auto; }
  .result-card{
    border:1px solid #eef2f7; border-radius:16px; background:#fff;
    box-shadow:0 8px 24px rgba(2,6,23,.05);
    transition:.25s ease; overflow:hidden;
  }
  .result-card:hover{ transform: translateY(-3px); box-shadow:0 16px 36px rgba(2,6,23,.10); }
  .airline-pill{ display:inline-flex; align-items:center; gap:.5rem; padding:.35rem .6rem; border-radius:999px; border:1px solid #e5e7eb; background:#f8fafc; font-weight:600; font-size:.85rem; }
  .badges .badge{ background:#f8fafc; border:1px solid #e5e7eb; color:#1f2937; font-weight:600; }
  .route-vis{ position:relative; padding:6px 0 0; }
  .route-vis .dot{ width:8px; height:8px; border-radius:50%; background:var(--brand-deep); }
  .route-vis .dash{ flex:1; height:2px; background:linear-gradient(90deg, var(--brand-deep) 50%, transparent 0); background-size:12px 2px; opacity:.6; }
  .route-vis .plane{ font-size:16px; margin:0 .25rem; }
  .price{ font-weight:800; font-size:1.25rem; }
  .book-btn{ border-radius:10px; font-weight:700; }
  .fav{ cursor:pointer; color:#94a3b8; }
  .fav.active{ color:#ef4444; }

  /* Empty state */
  .empty{ border:1px dashed #cbd5e1; border-radius:18px; background:#ffffff80; }

  /* Skeletons */
  .skeleton{ position:relative; overflow:hidden; background:#f1f5f9; }
  .skeleton::after{ content:""; position:absolute; inset:0; background: linear-gradient(90deg, transparent, rgba(255,255,255,.6), transparent); animation: shimmer 1.2s infinite; }
  @keyframes shimmer{ 0%{transform:translateX(-100%)} 100%{transform:translateX(100%)} }

  /* ===== Bottom sections ===== */
  .section-wrap{ max-width:1160px; margin-inline:auto; }
  .section-title{ font-weight:800; }
  .inspire-card{
    border:none; border-radius:18px; overflow:hidden; background:#fff;
    box-shadow:0 10px 28px rgba(2,6,23,.08); transition:transform .25s, box-shadow .25s;
  }
  .inspire-card:hover{ transform:translateY(-6px); box-shadow:0 18px 40px rgba(2,6,23,.12); }
  .inspire-img{ height:180px; width:100%; object-fit:cover; }
  .inspire-body{ padding:12px 14px; }
  .inspire-price{ font-weight:800; }
  .trust-strip{
    background:#ffffffba; border:1px solid rgba(2,6,23,.08); border-radius:16px;
    backdrop-filter: blur(8px);
  }
  .trust-item{
    display:flex; align-items:center; gap:.6rem; padding:.7rem 1rem; border-radius:12px; background:#f8fafc;
    border:1px solid #e5e7eb; font-weight:700;
  }
  .alert-card{
    background: linear-gradient(135deg, var(--brand-deep), var(--brand));
    color:#fff; border-radius:22px; padding:22px; position:relative; overflow:hidden;
    box-shadow:0 20px 40px rgba(2,6,23,.12);
  }
  .alert-card::after{
    content:""; position:absolute; inset:-20% -10% auto -10%;
    height:220px; background: radial-gradient(500px 240px at 20% 20%, rgba(255,255,255,.18), transparent 40%);
  }
  .alert-card .form-control{ border-color:transparent; }
  .alert-card .form-control:focus{ box-shadow:0 0 0 .25rem rgba(255,255,255,.35); }
  .alert-card .btn{ border-radius:12px; font-weight:800; }
  .support-cta{
    background:#fff; border:1px solid #e5e7eb; border-radius:18px; box-shadow:0 10px 28px rgba(2,6,23,.08);
  }
  .faq .accordion-button{ font-weight:700; }
  .faq .accordion-button:not(.collapsed){ color:#0b2545; background:#eef6ff; box-shadow:none; }

  @media (max-width: 768px){
    .btn-search{ width:100%; }
  }
  @media (prefers-reduced-motion: reduce){
    .sky-anim::before, .auth-cloud { animation:none!important; }
  }
</style>

<!-- Background layers -->
<div class="sky-anim" aria-hidden="true"></div>
<img src="https://upload.wikimedia.org/wikipedia/commons/3/3a/Cloud_icon.svg" class="auth-cloud c1" alt="" aria-hidden="true">
<img src="https://upload.wikimedia.org/wikipedia/commons/3/3a/Cloud_icon.svg" class="auth-cloud c2" alt="" aria-hidden="true">

<!-- ===== Page Header ===== -->
<div class="py-4 text-center page-head">
  <div class="brand-badge mb-2">
    <i class="bi bi-airplane-fill text-primary"></i>
    <span class="fw-bold">SkyWings</span>
  </div>
  <h2 class="fw-bold">Find Your Perfect Flight</h2>
  <p class="text-muted">Search and book flights to destinations around the world</p>
</div>

<!-- ===== Search Card ===== -->
<div class="container mb-4">
  <div class="search-card">
    <form id="flightSearch" class="row g-3 align-items-end" method="get" action="/search" novalidate>
      <!-- Trip type -->
      <div class="col-12 trip-toggle d-flex gap-2 px-2">
        <input type="hidden" name="trip" id="tripType" value="{{ request.args.get('trip','oneway') }}">
        <button type="button" class="btn btn-light border {% if request.args.get('trip','oneway')=='oneway' %}active{% endif %}" data-trip="oneway"><i class="bi bi-arrow-right"></i> One-way</button>
        <button type="button" class="btn btn-light border {% if request.args.get('trip')=='round' %}active{% endif %}" data-trip="round"><i class="bi bi-arrow-left-right"></i> Round trip</button>
      </div>

      <!-- From / To -->
      <div class="col-md-5">
        <label class="form-label">From</label>
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-geo-alt"></i></span>
          <input type="text" name="origin" id="origin" class="form-control" placeholder="e.g., YYZ" value="{{ request.args.get('origin','') }}" required pattern="[A-Za-z]{3}">
        </div>
      </div>
      <div class="col-md-1 d-none d-md-block text-center">
        <button type="button" id="swapBtn" class="btn swap-btn mt-4" title="Swap">
          <i class="bi bi-arrow-left-right"></i>
        </button>
      </div>
      <div class="col-md-5">
        <label class="form-label">To</label>
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-geo"></i></span>
          <input type="text" name="destination" id="destination" class="form-control" placeholder="e.g., JFK" value="{{ request.args.get('destination','') }}" required pattern="[A-Za-z]{3}">
        </div>
      </div>

      <!-- Dates -->
      <div class="col-md-3">
        <label class="form-label">Departure</label>
        <input type="date" name="depart" id="depart" class="form-control" value="{{ request.args.get('depart','') }}" required>
      </div>
      <div class="col-md-3">
        <label class="form-label">Return</label>
        <input type="date" name="return" id="return" class="form-control" value="{{ request.args.get('return','') }}" {% if request.args.get('trip','oneway')=='oneway' %}disabled{% endif %}>
      </div>

      <!-- Pax / Cabin -->
      <div class="col-md-2">
        <label class="form-label">Passengers</label>
        <select class="form-select" name="pax">
          {% for n in range(1,10) %}
            <option value="{{n}}" {% if request.args.get('pax','1')==n|string %}selected{% endif %}>{{n}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label">Cabin</label>
        <select class="form-select" name="cabin">
          {% set cabin = request.args.get('cabin','economy') %}
          <option value="economy" {{ 'selected' if cabin=='economy' }}>Economy</option>
          <option value="premium" {{ 'selected' if cabin=='premium' }}>Premium</option>
          <option value="business" {{ 'selected' if cabin=='business' }}>Business</option>
          <option value="first" {{ 'selected' if cabin=='first' }}>First</option>
        </select>
      </div>

      <!-- Nonstop + Search -->
      <div class="col-md-2">
        <div class="form-check mt-4">
          <input class="form-check-input" type="checkbox" value="1" id="nonstop" name="nonstop" {% if request.args.get('nonstop') %}checked{% endif %}>
          <label class="form-check-label" for="nonstop">Nonstop only</label>
        </div>
      </div>
      <div class="col-md-2 d-grid ms-auto">
        <button class="btn btn-search fw-semibold" id="searchBtn">
          <i class="bi bi-search me-1"></i> Search
        </button>
      </div>

      <!-- Quick chips -->
      <div class="col-12">
        <div class="quick-chips mt-1 px-1">
          <button type="button" class="chip btn btn-sm" data-chip="YYZ,JFK"><i class="bi bi-geo-alt"></i> Toronto ‚Üí New York</button>
          <button type="button" class="chip btn btn-sm" data-chip="YYZ,LAX"><i class="bi bi-geo-alt"></i> Toronto ‚Üí Los Angeles</button>
          <button type="button" class="chip btn btn-sm" data-chip="YYZ,YVR"><i class="bi bi-geo-alt"></i> Toronto ‚Üí Vancouver</button>
          <button type="button" class="chip btn btn-sm" data-chip="YYZ,DXB"><i class="bi bi-geo-alt"></i> Toronto ‚Üí Dubai</button>
        </div>
      </div>

      <!-- Advanced filters -->
      <div class="col-12">
        <div class="d-flex align-items-center gap-2 adv-toggle text-muted">
          <i class="bi bi-sliders"></i><span class="fw-semibold">Advanced filters</span><i class="bi bi-chevron-down ms-1"></i>
        </div>
        <div class="adv-panel mt-3">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Max price</label>
              <div class="range-wrap">
                <input type="range" id="priceRange" min="50" max="2000" step="10" value="{{ request.args.get('max','2000') }}">
                <span id="priceOut" class="small text-muted">$<span>2000</span></span>
              </div>
            </div>
            <div class="col-md-4">
              <label class="form-label">Earliest departure</label>
              <input type="time" id="timeFrom" class="form-control" value="00:00">
            </div>
            <div class="col-md-4">
              <label class="form-label">Latest departure</label>
              <input type="time" id="timeTo" class="form-control" value="23:59">
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>

{% if flights is defined %}
  <div class="container results-wrap my-4">
    <div class="summary-bar d-flex align-items-center justify-content-between mb-3">
      <div class="d-flex flex-wrap gap-2">
        {% if request.args.get('origin') %}<span class="tag"><i class="bi bi-geo-alt"></i> {{ request.args.get('origin')|upper }}</span>{% endif %}
        {% if request.args.get('destination') %}<span class="tag"><i class="bi bi-geo"></i> {{ request.args.get('destination')|upper }}</span>{% endif %}
        {% if request.args.get('depart') %}<span class="tag"><i class="bi bi-calendar-event"></i> {{ request.args.get('depart') }}</span>{% endif %}
        {% if request.args.get('trip') == 'round' and request.args.get('return') %}<span class="tag"><i class="bi bi-calendar-check"></i> {{ request.args.get('return') }}</span>{% endif %}
        {% if request.args.get('nonstop') %}<span class="tag"><i class="bi bi-lightning-charge"></i> Nonstop</span>{% endif %}
      </div>
      <div class="d-flex align-items-center gap-2">
        <label class="small text-muted">Sort</label>
        <select class="form-select form-select-sm" id="sortSelect" style="width:auto;">
          <option value="price">Price (low ‚Üí high)</option>
          <option value="depart">Departure time</option>
        </select>
      </div>
    </div>

    {% if flights %}
      <div id="resultsList" class="vstack gap-3">
        {% for f in flights %}
          {% set price_num = (f.price_cents/100)|float %}
          {% set depart_str = f.depart_time.strftime('%Y-%m-%d %H:%M') %}
          <div class="result-card p-3 p-md-4"
               data-price="{{ '%.2f' % price_num }}"
               data-depart="{{ f.depart_time.strftime('%H:%M') }}"
               data-date="{{ f.depart_time.strftime('%Y-%m-%d') }}">
            <div class="row align-items-center g-3">
              <div class="col-md-5">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="airline-pill mb-2">
                    <i class="bi bi-airplane"></i>
                    <span>{{ f.airline if f.airline is defined else 'SkyWings Partner' }}</span>
                  </div>
                  <i class="bi bi-heart fav" title="Save"></i>
                </div>
                <div class="d-flex align-items-center gap-2">
                  <div class="fs-5 fw-bold">{{ f.origin }}</div>
                  <div class="route-vis d-flex align-items-center flex-grow-1">
                    <span class="dot"></span><span class="dash"></span><span class="plane">‚úàÔ∏è</span><span class="dash"></span><span class="dot"></span>
                  </div>
                  <div class="fs-5 fw-bold">{{ f.destination }}</div>
                </div>
                <div class="text-muted small mt-1">
                  Departs: <span class="dep">{{ depart_str }}</span>
                  {% if f.arrive_time is defined %} ¬∑ Arrives: {{ f.arrive_time.strftime('%Y-%m-%d %H:%M') }}{% endif %}
                </div>
                <div class="badges d-flex flex-wrap gap-2 mt-2">
                  {% if f.stops is defined %}
                    <span class="badge rounded-pill">{{ 'Nonstop' if f.stops==0 else f.stops ~ ' stop' ~ ('s' if f.stops>1 else '') }}</span>
                  {% else %}
                    <span class="badge rounded-pill">Economy</span>
                  {% endif %}
                  <span class="badge rounded-pill">Free carry-on</span>
                  <span class="badge rounded-pill">24h cancellation</span>
                </div>
              </div>
              <div class="col-md-7">
                <div class="d-flex align-items-center justify-content-end gap-3 h-100">
                  <div class="text-end">
                    <div class="price">${{ '%.2f' % price_num }}</div>
                    <div class="small text-muted">Taxes & fees included</div>
                  </div>
                    <a class="btn btn-primary book-btn" href="/flights/{{ f.id }}/seats">
                      <i class="bi bi-ticket-perforated me-1"></i> Book
                    </a>


                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty p-4 text-center">
        <div class="display-6 mb-2">üõ∞Ô∏è</div>
        <h5 class="fw-bold">No flights found</h5>
        <p class="text-muted mb-0">Try different dates or nearby airports.</p>
      </div>
    {% endif %}
  </div>
{% else %}
  <!-- Skeleton state before results -->
  <div class="container results-wrap my-4">
    <div class="vstack gap-3">
      {% for _ in range(3) %}
        <div class="result-card p-3">
          <div class="row g-3">
            <div class="col-md-5"><div class="skeleton rounded-3" style="height:70px;"></div></div>
            <div class="col-md-7"><div class="skeleton rounded-3" style="height:50px;"></div></div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
{% endif %}

<!-- ===== Inspiration grid ===== -->
<section class="section-wrap my-5">
  <div class="d-flex align-items-end justify-content-between mb-3">
    <div>
      <h3 class="section-title mb-1">Get inspired</h3>
      <p class="text-muted mb-0">Popular picks leaving from Toronto</p>
    </div>
  </div>
  <div class="row g-3">
    <div class="col-12 col-sm-6 col-lg-3">
      <div class="inspire-card">
        <img class="inspire-img" src="https://images.unsplash.com/flagged/photo-1575597255483-55f2afb6f42c?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=687">
        <div class="inspire-body">
          <div class="d-flex justify-content-between"><strong>New York (JFK)</strong><span class="inspire-price">$199+</span></div>
          <div class="small text-muted">3‚Äì5x daily ‚Ä¢ 1h30m</div>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
      <div class="inspire-card">
        <img class="inspire-img" src="https://images.unsplash.com/photo-1511739001486-6bfe10ce785f?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=687" alt="Paris">
        <div class="inspire-body">
          <div class="d-flex justify-content-between"><strong>Paris (CDG)</strong><span class="inspire-price">$599+</span></div>
          <div class="small text-muted">Overnight ‚Ä¢ 7h15m</div>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
      <div class="inspire-card">
        <img class="inspire-img" src="https://plus.unsplash.com/premium_photo-1725408106567-a77bd9beff7c?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=870" alt="Los Angeles">
        <div class="inspire-body">
          <div class="d-flex justify-content-between"><strong>Los Angeles (LAX)</strong><span class="inspire-price">$349+</span></div>
          <div class="small text-muted">Direct & 1-stop ‚Ä¢ 5h</div>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
      <div class="inspire-card">
        <img class="inspire-img" src="https://images.unsplash.com/photo-1609825488888-3a766db05542?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=1032" alt="Vancouver">
        <div class="inspire-body">
          <div class="d-flex justify-content-between"><strong>Vancouver (YVR)</strong><span class="inspire-price">$159+</span></div>
          <div class="small text-muted">Multiple daily ‚Ä¢ 5h</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== Partners / Trust strip ===== -->
<section class="section-wrap my-5">
  <div class="trust-strip p-3 p-md-4">
    <div class="row g-3 align-items-center">
      <div class="col-md-3">
        <h6 class="m-0 fw-bold"><i class="bi bi-shield-lock me-2"></i>Trusted partners</h6>
        <div class="small text-muted">Secure payments ‚Ä¢ Verified carriers</div>
      </div>
      <div class="col-md-9">
        <div class="d-flex flex-wrap gap-2">
          <span class="trust-item"><i class="bi bi-credit-card"></i> Visa</span>
          <span class="trust-item"><i class="bi bi-credit-card-2-front"></i> MasterCard</span>
          <span class="trust-item"><i class="bi bi-credit-card"></i> AmEx</span>
          <span class="trust-item"><i class="bi bi-shield-check"></i> 3-D Secure</span>
          <span class="trust-item"><i class="bi bi-fingerprint"></i> MFA</span>
          <span class="trust-item"><i class="bi bi-lock"></i> TLS 1.3</span>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== Price alerts / newsletter ===== -->
<section class="section-wrap my-5">
  <div class="alert-card">
    <div class="row g-3 align-items-center">
      <div class="col-md-7">
        <h4 class="fw-bold mb-1">Set price alerts</h4>
        <p class="mb-0">Get an email when fares drop for your route. No spam ‚Äî just savings.</p>
      </div>
      <div class="col-md-5">
        <form id="alertForm" class="row g-2">
          <div class="col-8">
            <input type="email" class="form-control form-control-lg" id="alertEmail" placeholder="you@example.com" required>
          </div>
          <div class="col-4 d-grid">
            <button class="btn btn-light btn-lg fw-bold" id="alertBtn" type="submit">
              <i class="bi bi-bell me-1"></i> Alert me
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<!-- ===== FAQ ===== -->
<!-- ===== FAQ (drops open) ===== -->
<section class="section-wrap my-5 faq">
  <h3 class="section-title mb-3">Frequently asked questions</h3>
  <div class="accordion" id="faqAcc">
    <div class="accordion-item">
      <h2 class="accordion-header" id="q1">
        <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#a1"
                aria-expanded="false" aria-controls="a1">
          Can I cancel or change my ticket?
          <span class="ms-auto chev"><i class="bi bi-chevron-down"></i></span>
        </button>
      </h2>
      <div id="a1" class="accordion-collapse collapse" aria-labelledby="q1" data-bs-parent="#faqAcc">
        <div class="accordion-body">
          Most fares include a <strong>24-hour free cancellation</strong>. After that, changes depend on the airline‚Äôs policy and fare class.
        </div>
      </div>
    </div>

    <div class="accordion-item">
      <h2 class="accordion-header" id="q2">
        <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#a2"
                aria-expanded="false" aria-controls="a2">
          What baggage is included?
          <span class="ms-auto chev"><i class="bi bi-chevron-down"></i></span>
        </button>
      </h2>
      <div id="a2" class="accordion-collapse collapse" aria-labelledby="q2" data-bs-parent="#faqAcc">
        <div class="accordion-body">
          Most economy fares include a <strong>free carry-on</strong>. Checked bag fees vary by route and carrier; you‚Äôll see options at checkout.
        </div>
      </div>
    </div>

    <div class="accordion-item">
      <h2 class="accordion-header" id="q3">
        <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#a3"
                aria-expanded="false" aria-controls="a3">
          Do prices include taxes and fees?
          <span class="ms-auto chev"><i class="bi bi-chevron-down"></i></span>
        </button>
      </h2>
      <div id="a3" class="accordion-collapse collapse" aria-labelledby="q3" data-bs-parent="#faqAcc">
        <div class="accordion-body">
          Yes ‚Äî prices shown are <strong>all-in</strong> so there are no surprises at the last step.
        </div>
      </div>
    </div>
  </div>
</section>


<!-- ===== Support CTA ===== -->
<section class="section-wrap my-5">
  <div class="support-cta p-4 p-md-5 d-flex flex-column flex-md-row align-items-center justify-content-between">
    <div class="mb-3 mb-md-0">
      <h4 class="fw-bold mb-1"><i class="bi bi-headset me-2"></i>Need a hand?</h4>
      <p class="text-muted mb-0">Our team is here 24/7 ‚Äî real humans, real help.</p>
    </div>
    <div class="d-flex gap-2">
      <a href="/support" class="btn btn-outline-primary fw-semibold"><i class="bi bi-chat-dots me-1"></i> Live chat</a>
      <a href="/help" class="btn btn-primary fw-semibold"><i class="bi bi-life-preserver me-1"></i> Help center</a>
    </div>
  </div>
</section>

<script>
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

  // Dates: min= today; return >= depart
  (() => {
    const d = $('#depart'); if(!d) return;
    const today = new Date(); const y=today.getUTCFullYear();
    const m=String(today.getUTCMonth()+1).padStart(2,'0');
    const day=String(today.getUTCDate()).padStart(2,'0');
    d.min = `${y}-${m}-${day}`;
    const r = $('#return'); if(r) r.min = d.value || d.min;
    d.addEventListener('change', ()=>{ if(r && (!r.value || r.value < d.value)) r.value = d.value; r && (r.min = d.value); });
  })();

  // Trip toggle (one-way vs round)
  (() => {
    const tripInput = $('#tripType'); const r = $('#return');
    $$('.trip-toggle .btn').forEach(btn=>{
      btn.addEventListener('click',()=>{
        $$('.trip-toggle .btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const val = btn.getAttribute('data-trip');
        tripInput.value = val;
        if(val==='oneway'){ r.disabled = true; r.value = ''; }
        else { r.disabled = false; if(!r.value) r.value = $('#depart').value; }
      });
    });
  })();

  // Swap origin <-> destination
  (() => {
    const a = $('#origin'), b = $('#destination'), swap = $('#swapBtn');
    if(swap && a && b){ swap.addEventListener('click', ()=>{ [a.value, b.value] = [b.value, a.value]; a.focus(); }); }
  })();

  // Quick chips
  (() => {
    const a = $('#origin'), b = $('#destination');
    $$('.quick-chips .chip').forEach(chip=>{
      chip.addEventListener('click', ()=>{
        const [from,to] = chip.getAttribute('data-chip').split(',');
        a.value = from; b.value = to; $('#depart')?.focus();
      });
    });
  })();

  // Advanced filters toggle
  (() => {
    const t = $('.adv-toggle'); const p = $('.adv-panel'); if(!t || !p) return;
    t.addEventListener('click', ()=>{ p.style.display = (p.style.display==='block' ? 'none' : 'block'); });
  })();

  // Favorites 
  (() => {
    const KEY = 'sw_favs';
    const load = () => JSON.parse(localStorage.getItem(KEY) || '[]');
    const save = (arr) => localStorage.setItem(KEY, JSON.stringify(arr));
    const favs = new Set(load());
    $$('.result-card .fav').forEach(icon=>{
      const card = icon.closest('.result-card');
      const id = card?.querySelector('a.book-btn')?.href || '';
      if(favs.has(id)) icon.classList.add('active');
      icon.addEventListener('click', ()=>{
        icon.classList.toggle('active');
        if(icon.classList.contains('active')) favs.add(id); else favs.delete(id);
        save([...favs]);
      });
    });
  })();

  // Client-side sort & filter (price/time & advanced panel)
  (() => {
    const list = $('#resultsList'); if(!list) return;
    const cards = () => $$('.result-card', list);

    function applyFilters(){
      const maxPrice = parseFloat($('#priceRange')?.value || '2000');
      const tFrom = ($('#timeFrom')?.value || '00:00');
      const tTo   = ($('#timeTo')?.value   || '23:59');

      cards().forEach(c=>{
        const price = parseFloat(c.dataset.price);
        const dep   = c.dataset.depart;
        const okPrice = price <= maxPrice;
        const okTime  = dep >= tFrom && dep <= tTo;
        c.style.display = (okPrice && okTime) ? '' : 'none';
      });
    }

    function sortBy(key){
      const arr = cards().filter(c=>c.style.display!=='none');
      arr.sort((a,b)=>{
        if(key==='price') return parseFloat(a.dataset.price) - parseFloat(b.dataset.price);
        if(key==='depart') return a.dataset.date.localeCompare(b.dataset.date) || a.dataset.depart.localeCompare(b.dataset.depart);
        return 0;
      });
      arr.forEach(c=>list.appendChild(c));
    }

    $('#priceRange')?.addEventListener('input', (e)=>{ $('#priceOut span').textContent = e.target.value; applyFilters(); });
    $('#timeFrom')?.addEventListener('change', applyFilters);
    $('#timeTo')?.addEventListener('change', applyFilters);
    $('#sortSelect')?.addEventListener('change', (e)=> sortBy(e.target.value));

    if($('#priceRange')) $('#priceOut span').textContent = $('#priceRange').value;
    applyFilters();
    sortBy($('#sortSelect')?.value || 'price');
  })();

  // Submit loading
  (() => {
    const form = $('#flightSearch'); const btn = $('#searchBtn');
    if(form && btn){
      form.addEventListener('submit', ()=>{
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status"></span>Searching...';
      });
    }
  })();

  // Price alert (UI only)
  (() => {
    const form = document.getElementById('alertForm');
    const btn  = document.getElementById('alertBtn');
    const email= document.getElementById('alertEmail');
    if(!form) return;
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      if(!email.value) return;
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status"></span>Setting alert...';
      setTimeout(()=>{
        btn.classList.remove('btn-light'); btn.classList.add('btn-success');
        btn.innerHTML = '<i class="bi bi-check2-circle me-1"></i> Alert set!';
      }, 800);
    });
  })();
</script>
{% endblock %}



